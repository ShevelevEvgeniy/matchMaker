# MatchMaker

Этот проект представляет собой простой сервис матчмейкера, написанный на языке Go. Сервис формирует группы игроков, основываясь на их задержке (latency), уровне навыка (skill) и времени ожидания в очереди.
### *Возможные функции:*
- *POST /users*
  Добавляет игрока в очередь матчмейкера. Запрос должен содержать следующие параметры:
  - name: Имя игрока (строка).
  - skill: Уровень навыка игрока (число с плавающей точкой).
  - latency: Задержка игрока (число с плавающей точкой).
### *База данных:*

*Для хранения данных используется СУБД PostgreSQL. В проекте определена таблица:*
- users - содержит информацию о пользователях, включая идентификатор, время начала ожидания и находиться ли пользователь в поиске.

### *Кэш:*
*Для хранения пользователей которые находяться в поиске вспомогательным инструментом выступает Redis* 
### *Формат входных данных:*

- Для ручки POST /users
  данные принимаются в формате JSON и включают поля:
    ```json
    {
      "users": [
        {
          "name": "user1",
          "Skill": 1.5,
          "Latency": 7.3
        }, 
        {
          "name": "user2",
          "Skill": 5.8,
          "Latency": 6.4
        }
      ]
    }
    ```
### *Формат данных на выходе:*
- Ручка POST /users возвращает статус код в формате JSON (пример удачного добавления):
  ```json
  {
    "status":201
  }
  ```
  
## Окружение

### Требования
- Docker 20.x.x
- Docker Compose 1.29.x
- Go 1.21+

### Переменные окружения

| Параметр                    | Описание                                           | Default             |
|-----------------------------|----------------------------------------------------|---------------------|
| `ENV_TYPE`                  | Режим окружения                                    | `development`       |
| `HTTP_SERVER_PORT `         | Порт для HTTP-сервера                              | `8081`              |
| `HTTP_SERVER_NAME `         | Имя HTTP сервера                                   | `match_maker`       |
| `HTTP_SERVER_TIMEOUT `      | Таймаут запроса к серверу                          | `4s`                |
| `HTTP_SERVER_IDLE_TIMEOUT ` | Таймаут простоя сервера                            | `60s`               |
| `DB_HOST`                   | Хост базы данных                                   | `localhost`         |
| `DB_PORT`                   | Порт базы данных                                   | `5432`              |
| `DB_NAME`                   | Имя базы данных                                    | `match_maker_db`    |
| `DB_USER_NAME`              | Имя пользователя базы данных                       | `user`              |
| `DB_PASSWORD`               | Пароль пользователя базы данных                    | `secret`            |
| `DB_SSL_MODE`               | Режим SSL для базы данных                          | `disable`           |
| `DB_DRIVER_NAME`            | Имя драйвера базы данных                           | `postgres`          |
| `DB_MAX_CONNS`              | Максимальное количество соединений БД              | `20`                |
| `MIGRATION_URL`             | URL для миграций                                   | `file://migrations` |
| `REDIS_NAME`                | Имя инстанса Redis                                 | `match_maker_redis` |
| `REDIS_HOST`                | Хост для подключения к Redis                       | `match_maker_redis` |
| `REDIS_PORT`                | Порт для подключения к Redis                       | `6379`              |
| `REDIS_DB`                  | Номер базы данных в Redis                          | `0`                 |
| `REMAINING_USERS_KEY`       | Ключ в Redis для хранения оставшихся пользователей | `remainig_usesrs`   |
| `GROUP_SIZE`                | Размер групп для формирования                      | `2`                 |
| `BATCH`                     | Размер извлекаемых данных из бд                    | `1000`              |
| `COUNT_WORKERS`             | Колличество воркеров для формирования групп        | `5`                 |
| `DELAY`                     | Время ожидания при отсутствии пользователей        | `5s`                |



## Установка

**PROJECT**

- Создать новую директорию для проекта. В консоли перейти в созданную директорию и написать: git clone https://github.com/ShevelevEvgeniy/matchMaker.git

**DOCKER**

*Сборка:*

Скопировать файл .env.dist и переименовать в .env, настроить параметры окружения cp .env.dist .env
Для развертывания, запустите установку, выполнив команду ниже: make install

*Служебное:*
- make migrate-up - Запуск миграций
- make migrate-down - Откат миграций
- make migrate-create name="$" - Создание новой миграции
- make restart - пересборка контейнера match_maker
- make run-tests - запуск тестов

Если у вас возникли вопросы или проблемы, вы можете связаться со мной по адресу Z_shevelev@mail.ru